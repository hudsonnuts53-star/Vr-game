<!DOCTYPE html>
<html>
<head>
  <title>RAGDOLL CITY CHAOS</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #blocker {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.95);
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      z-index: 9999; cursor: pointer;
    }
    #blocker h1 {
      color: #e74c3c; font-family: Arial Black;
      font-size: 3em; text-align: center;
      text-shadow: 0 0 20px #e74c3c;
    }
    #blocker p {
      color: #fff; font-family: Arial;
      font-size: 1.2em; text-align: center;
      max-width: 600px; line-height: 1.6;
    }
    #blocker .start-btn {
      margin-top: 20px; padding: 15px 50px;
      background: #e74c3c; color: #fff;
      border: none; font-size: 1.5em;
      font-family: Arial Black; cursor: pointer;
      border-radius: 5px;
    }
  </style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="blocker" onclick="startGame()">
  <h1>ü©∏ RAGDOLL CITY CHAOS ü©∏</h1>
  <p>
    PUNCH. SLASH. DESTROY.<br>
    Tear through ragdolls in a destructible city<br><br>
    üó°Ô∏è Weapons | üëä Fists | üí• Explosions | ü¶ø Dismemberment
  </p>
  <button class="start-btn">‚öîÔ∏è START CHAOS ‚öîÔ∏è</button>
  <p style="font-size:0.8em; margin-top:20px; color:#888;">
    LEFT TRIGGER = Grab/Use Weapon<br>
    RIGHT TRIGGER = Spawn Enemy<br>
    GRIP = Explosion<br>
    Spacebar = Spawn Enemy (desktop)
  </p>
</div>

<a-scene id="scene" physics="gravity: -12; debug: false" visible="false">

  <!-- SKY -->
  <a-gradient-sky material="shader: flat; color: #1a1a2e; opacity: 1"></a-gradient-sky>
  <a-sky color="#1a1a2e"></a-sky>

  <!-- FOG FOR MOOD -->
  <a-entity fog="type: exponential; color: #1a1a2e; density: 0.02"></a-entity>

  <!-- ============ GROUND ============ -->
  <a-plane static-body rotation="-90 0 0" width="100" height="100" color="#2c2c2c"
    material="roughness: 0.9"></a-plane>

  <!-- ROAD -->
  <a-plane static-body rotation="-90 0 0" position="0 0.01 0" width="12" height="100" color="#333"
    material="roughness: 0.8"></a-plane>

  <!-- ROAD LINES -->
  <a-plane rotation="-90 0 0" position="0 0.02 -5" width="0.3" height="3" color="#f1c40f"></a-plane>
  <a-plane rotation="-90 0 0" position="0 0.02 -10" width="0.3" height="3" color="#f1c40f"></a-plane>
  <a-plane rotation="-90 0 0" position="0 0.02 -15" width="0.3" height="3" color="#f1c40f"></a-plane>
  <a-plane rotation="-90 0 0" position="0 0.02 -20" width="0.3" height="3" color="#f1c40f"></a-plane>
  <a-plane rotation="-90 0 0" position="0 0.02 -25" width="0.3" height="3" color="#f1c40f"></a-plane>
  <a-plane rotation="-90 0 0" position="0 0.02 -30" width="0.3" height="3" color="#f1c40f"></a-plane>
  <a-plane rotation="-90 0 0" position="0 0.02 0" width="0.3" height="3" color="#f1c40f"></a-plane>
  <a-plane rotation="-90 0 0" position="0 0.02 5" width="0.3" height="3" color="#f1c40f"></a-plane>

  <!-- SIDEWALKS -->
  <a-box static-body position="7.5 0.15 -10" width="3" height="0.3" depth="60" color="#555"></a-box>
  <a-box static-body position="-7.5 0.15 -10" width="3" height="0.3" depth="60" color="#555"></a-box>

  <!-- ============ BUILDINGS LEFT SIDE ============ -->

  <!-- BUILDING 1 - Tall Red -->
  <a-entity id="building1" position="-14 0 -8">
    <a-box static-body position="0 5 0" width="8" height="10" depth="8" color="#8b1a1a"
      class="destructible" material="roughness: 0.7"></a-box>
    <!-- Windows -->
    <a-box position="-2 7 4.01" width="1.5" height="1.5" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="2 7 4.01" width="1.5" height="1.5" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="-2 4 4.01" width="1.5" height="1.5" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="2 4 4.01" width="1.5" height="1.5" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <!-- Door -->
    <a-box position="0 1.5 4.01" width="2" height="3" depth="0.1" color="#4a3728"></a-box>
  </a-entity>

  <!-- BUILDING 2 - Short Blue -->
  <a-entity position="-14 0 -20">
    <a-box static-body position="0 3.5 0" width="8" height="7" depth="10" color="#1a3a5c"
      class="destructible" material="roughness: 0.7"></a-box>
    <a-box position="-2 5 5.01" width="1.5" height="1.5" depth="0.1" color="#f1c40f" material="emissive: #f1c40f; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="2 5 5.01" width="1.5" height="1.5" depth="0.1" color="#f1c40f" material="emissive: #f1c40f; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="0 1.5 5.01" width="2" height="3" depth="0.1" color="#4a3728"></a-box>
  </a-entity>

  <!-- BUILDING 3 - Tall Gray -->
  <a-entity position="-15 0 4">
    <a-box static-body position="0 7 0" width="10" height="14" depth="8" color="#4a4a4a"
      class="destructible" material="roughness: 0.8"></a-box>
    <a-box position="-3 10 4.01" width="1.2" height="1.2" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="0 10 4.01" width="1.2" height="1.2" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="3 10 4.01" width="1.2" height="1.2" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="-3 7 4.01" width="1.2" height="1.2" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="0 7 4.01" width="1.2" height="1.2" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="3 7 4.01" width="1.2" height="1.2" depth="0.1" color="#4a90d9" material="emissive: #4a90d9; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="0 1.5 4.01" width="2.5" height="3" depth="0.1" color="#4a3728"></a-box>
  </a-entity>

  <!-- ============ BUILDINGS RIGHT SIDE ============ -->

  <!-- BUILDING 4 - Green Store -->
  <a-entity position="14 0 -8">
    <a-box static-body position="0 3 0" width="8" height="6" depth="8" color="#1a4a2a"
      class="destructible" material="roughness: 0.7"></a-box>
    <!-- Store front windows -->
    <a-box position="-2 2.5 4.01" width="2" height="3" depth="0.1" color="#87ceeb" material="emissive: #87ceeb; emissiveIntensity: 0.2; opacity: 0.7" class="destructible"></a-box>
    <a-box position="2 2.5 4.01" width="2" height="3" depth="0.1" color="#87ceeb" material="emissive: #87ceeb; emissiveIntensity: 0.2; opacity: 0.7" class="destructible"></a-box>
    <a-box position="0 1.5 4.01" width="1.5" height="3" depth="0.1" color="#4a3728"></a-box>
    <!-- Sign -->
    <a-box position="0 5.5 4.01" width="6" height="1" depth="0.1" color="#e74c3c"></a-box>
    <a-text value="SHOP" position="0 5.5 4.15" align="center" width="8" color="#fff"></a-text>
  </a-entity>

  <!-- BUILDING 5 - Purple Apartment -->
  <a-entity position="14 0 -22">
    <a-box static-body position="0 6 0" width="8" height="12" depth="10" color="#3a1a5c"
      class="destructible" material="roughness: 0.7"></a-box>
    <a-box position="-2 9 5.01" width="1.2" height="1.5" depth="0.1" color="#f39c12" material="emissive: #f39c12; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="2 9 5.01" width="1.2" height="1.5" depth="0.1" color="#f39c12" material="emissive: #f39c12; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="-2 6 5.01" width="1.2" height="1.5" depth="0.1" color="#f39c12" material="emissive: #f39c12; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="2 6 5.01" width="1.2" height="1.5" depth="0.1" color="#f39c12" material="emissive: #f39c12; emissiveIntensity: 0.3" class="destructible"></a-box>
    <a-box position="0 1.5 5.01" width="2" height="3" depth="0.1" color="#4a3728"></a-box>
  </a-entity>

  <!-- BUILDING 6 - Wide Industrial -->
  <a-entity position="16 0 5">
    <a-box static-body position="0 4 0" width="12" height="8" depth="8" color="#5a5a5a"
      class="destructible" material="roughness: 0.9"></a-box>
    <a-box position="-4 5 4.01" width="2" height="2" depth="0.1" color="#555" material="opacity: 0.5" class="destructible"></a-box>
    <a-box position="0 5 4.01" width="2" height="2" depth="0.1" color="#555" material="opacity: 0.5" class="destructible"></a-box>
    <a-box position="4 5 4.01" width="2" height="2" depth="0.1" color="#555" material="opacity: 0.5" class="destructible"></a-box>
    <!-- Garage door -->
    <a-box position="0 2 4.01" width="4" height="4" depth="0.1" color="#888"></a-box>
  </a-entity>

  <!-- ============ CARS ============ -->

  <!-- CAR 1 - Red -->
  <a-entity id="car1" class="destructible" position="3 0 -5">
    <a-box dynamic-body="mass: 50" position="0 0.6 0" width="2" height="1" depth="4" color="#c0392b" class="grabbable destructible"></a-box>
    <a-box dynamic-body="mass: 20" position="0 1.3 -0.3" width="1.8" height="0.8" depth="2" color="#a93226" class="grabbable destructible"></a-box>
    <!-- Wheels -->
    <a-cylinder static-body position="-1 0.3 1.2" rotation="0 0 90" radius="0.3" height="0.2" color="#111"></a-cylinder>
    <a-cylinder static-body position="1 0.3 1.2" rotation="0 0 90" radius="0.3" height="0.2" color="#111"></a-cylinder>
    <a-cylinder static-body position="-1 0.3 -1.2" rotation="0 0 90" radius="0.3" height="0.2" color="#111"></a-cylinder>
    <a-cylinder static-body position="1 0.3 -1.2" rotation="0 0 90" radius="0.3" height="0.2" color="#111"></a-cylinder>
    <!-- Headlights -->
    <a-sphere position="-0.6 0.6 2" radius="0.15" color="#f1c40f" material="emissive: #f1c40f; emissiveIntensity: 1"></a-sphere>
    <a-sphere position="0.6 0.6 2" radius="0.15" color="#f1c40f" material="emissive: #f1c40f; emissiveIntensity: 1"></a-sphere>
  </a-entity>

  <!-- CAR 2 - Blue -->
  <a-entity position="-3 0 -15">
    <a-box dynamic-body="mass: 50" position="0 0.6 0" width="2" height="1" depth="4" color="#2980b9" class="grabbable destructible"></a-box>
    <a-box dynamic-body="mass: 20" position="0 1.3 -0.3" width="1.8" height="0.8" depth="2" color="#2471a3" class="grabbable destructible"></a-box>
    <a-cylinder static-body position="-1 0.3 1.2" rotation="0 0 90" radius="0.3" height="0.2" color="#111"></a-cylinder>
    <a-cylinder static-body position="1 0.3 1.2" rotation="0 0 90" radius="0.3" height="0.2" color="#111"></a-cylinder>
    <a-cylinder static-body position="-1 0.3 -1.2" rotation="0 0 90" radius="0.3" height="0.2" color="#111"></a-cylinder>
    <a-cylinder static-body position="1 0.3 -1.2" rotation="0 0 90" radius="0.3" height="0.2" color="#111"></a-cylinder>
    <a-sphere position="-0.6 0.6 2" radius="0.15" color="#f1c40f" material="emissive: #f1c40f; emissiveIntensity: 1"></a-sphere>
    <a-sphere position="0.6 0.6 2" radius="0.15" color="#f1c40f" material="emissive: #f1c40f; emissiveIntensity: 1"></a-sphere>
  </a-entity>

  <!-- CAR 3 - Flipped Yellow (chaos) -->
  <a-entity position="4 0 -22" rotation="0 30 0">
    <a-box dynamic-body="mass: 50" position="0 0.6 0" width="2" height="1" depth="4" color="#f39c12" class="grabbable destructible"></a-box>
    <a-box dynamic-body="mass: 20" position="0 1.3 -0.3" width="1.8" height="0.8" depth="2" color="#d68910" class="grabbable destructible"></a-box>
  </a-entity>

  <!-- ============ STREET PROPS ============ -->

  <!-- Street Lights -->
  <a-entity position="6 0 -5">
    <a-cylinder static-body position="0 2.5 0" radius="0.1" height="5" color="#333"></a-cylinder>
    <a-box position="0 5.2 0" width="0.5" height="0.3" depth="0.5" color="#333"></a-box>
    <a-sphere position="0 5 0" radius="0.2" color="#f1c40f" material="emissive: #f1c40f; emissiveIntensity: 2"></a-sphere>
    <a-light type="point" position="0 5 0" intensity="0.5" distance="15" color="#f1c40f"></a-light>
  </a-entity>

  <a-entity position="-6 0 -15">
    <a-cylinder static-body position="0 2.5 0" radius="0.1" height="5" color="#333"></a-cylinder>
    <a-box position="0 5.2 0" width="0.5" height="0.3" depth="0.5" color="#333"></a-box>
    <a-sphere position="0 5 0" radius="0.2" color="#f1c40f" material="emissive: #f1c40f; emissiveIntensity: 2"></a-sphere>
    <a-light type="point" position="0 5 0" intensity="0.5" distance="15" color="#f1c40f"></a-light>
  </a-entity>

  <a-entity position="6 0 -25">
    <a-cylinder static-body position="0 2.5 0" radius="0.1" height="5" color="#333"></a-cylinder>
    <a-box position="0 5.2 0" width="0.5" height="0.3" depth="0.5" color="#333"></a-box>
    <a-sphere position="0 5 0" radius="0.2" color="#f1c40f" material="emissive: #f1c40f; emissiveIntensity: 2"></a-sphere>
    <a-light type="point" position="0 5 0" intensity="0.5" distance="15" color="#f1c40f"></a-light>
  </a-entity>

  <!-- Dumpster -->
  <a-box dynamic-body="mass: 30" position="9 0.6 -12" width="2" height="1.2" depth="1.5" color="#2d5a27" class="grabbable destructible"></a-box>

  <!-- Trash Cans -->
  <a-cylinder dynamic-body="mass: 5" position="-6 0.5 -8" radius="0.3" height="1" color="#777" class="grabbable destructible"></a-cylinder>
  <a-cylinder dynamic-body="mass: 5" position="-6 0.5 -9" radius="0.3" height="1" color="#777" class="grabbable destructible"></a-cylinder>

  <!-- Barrels -->
  <a-cylinder dynamic-body="mass: 15" position="9 0.6 -18" radius="0.4" height="1.2" color="#c0392b" class="grabbable destructible"></a-cylinder>
  <a-cylinder dynamic-body="mass: 15" position="9.8 0.6 -18.5" radius="0.4" height="1.2" color="#c0392b" class="grabbable destructible"></a-cylinder>

  <!-- Crates -->
  <a-box dynamic-body="mass: 10" position="-9 0.5 -20" width="1" height="1" depth="1" color="#8B4513" class="grabbable destructible"></a-box>
  <a-box dynamic-body="mass: 10" position="-9 1.5 -20" width="1" height="1" depth="1" color="#8B4513" class="grabbable destructible"></a-box>
  <a-box dynamic-body="mass: 10" position="-10 0.5 -20" width="1" height="1" depth="1" color="#8B4513" class="grabbable destructible"></a-box>

  <!-- Fire Hydrant -->
  <a-entity position="-6 0 -5">
    <a-cylinder static-body position="0 0.4 0" radius="0.2" height="0.8" color="#e74c3c"></a-cylinder>
    <a-sphere position="0 0.9 0" radius="0.15" color="#c0392b"></a-sphere>
  </a-entity>

  <!-- ============ WEAPON RACK ============ -->
  <a-entity id="weaponRack" position="0 0 2">
    <!-- Rack Frame -->
    <a-box static-body position="0 1 0" width="6" height="0.2" depth="1" color="#4a3728"></a-box>
    <a-cylinder static-body position="-3 0.5 0" radius="0.1" height="1" color="#4a3728"></a-cylinder>
    <a-cylinder static-body position="3 0.5 0" radius="0.1" height="1" color="#4a3728"></a-cylinder>

    <!-- SWORD -->
    <a-entity id="sword" class="grabbable weapon" weapon-type="sword" dynamic-body="mass: 3" position="-2 1.5 0">
      <a-box width="0.08" height="1.2" depth="0.02" color="#bdc3c7" material="metalness: 0.9; roughness: 0.1"></a-box>
      <a-box position="0 -0.7 0" width="0.3" height="0.15" depth="0.08" color="#8B4513"></a-box>
      <a-cylinder position="0 -0.85 0" radius="0.05" height="0.3" color="#4a3728"></a-cylinder>
    </a-entity>

    <!-- AXE -->
    <a-entity id="axe" class="grabbable weapon" weapon-type="axe" dynamic-body="mass: 5" position="-0.7 1.5 0">
      <a-cylinder radius="0.04" height="1.2" color="#8B4513"></a-cylinder>
      <a-box position="0.15 0.45 0" width="0.35" height="0.3" depth="0.05" color="#777" material="metalness: 0.8; roughness: 0.2"></a-box>
    </a-entity>

    <!-- HAMMER -->
    <a-entity id="hammer" class="grabbable weapon" weapon-type="hammer" dynamic-body="mass: 8" position="0.7 1.5 0">
      <a-cylinder radius="0.04" height="1" color="#8B4513"></a-cylinder>
      <a-box position="0 0.45 0" width="0.4" height="0.25" depth="0.25" color="#555" material="metalness: 0.9; roughness: 0.1"></a-box>
    </a-entity>

    <!-- BASEBALL BAT -->
    <a-entity id="bat" class="grabbable weapon" weapon-type="bat" dynamic-body="mass: 4" position="2 1.5 0">
      <a-cylinder radius="0.03" height="0.8" color="#DEB887"></a-cylinder>
      <a-cylinder position="0 0.45 0" radius="0.06" height="0.3" color="#D2691E"></a-cylinder>
    </a-entity>

    <!-- Rack Label -->
    <a-text value="‚öîÔ∏è GRAB A WEAPON ‚öîÔ∏è" position="0 2.2 0" align="center" width="6" color="#e74c3c"></a-text>
  </a-entity>

  <!-- ============ HUD ============ -->
  <a-text id="killCounter" value="KILLS: 0" position="0 8 -15" align="center" width="20" color="#e74c3c"
    font="mozillavr" material="emissive: #e74c3c"></a-text>

  <a-text id="waveText" value="" position="0 6.5 -15" align="center" width="15" color="#fff"
    font="mozillavr"></a-text>

  <!-- ============ PLAYER RIG ============ -->
  <a-entity id="rig" movement-controls="fly: false; speed: 0.15" position="0 0 5">
    <a-entity camera position="0 1.6 0" look-controls="pointerLockEnabled: false"></a-entity>

    <!-- LEFT HAND -->
    <a-entity
      id="leftHand"
      hand-controls="hand: left; handModelStyle: lowPoly"
      laser-controls="hand: left"
      raycaster="objects: .grabbable; far: 3"
      grip-grab
      hand-collider="hand: left">
    </a-entity>

    <!-- RIGHT HAND -->
    <a-entity
      id="rightHand"
      hand-controls="hand: right; handModelStyle: lowPoly"
      laser-controls="hand: right"
      raycaster="objects: .grabbable; far: 3"
      enemy-spawner-controller
      hand-collider="hand: right">
    </a-entity>
  </a-entity>

  <!-- ============ LIGHTING ============ -->
  <a-light type="ambient" intensity="0.3" color="#667"></a-light>
  <a-light type="directional" position="5 15 10" intensity="0.4" color="#ffeedd" castShadow="true"></a-light>
  <a-light type="point" position="0 10 -10" intensity="0.3" distance="40" color="#e74c3c"></a-light>

</a-scene>

<script>
// ============ GAME VARIABLES ============
let kills = 0;
let wave = 1;
let enemiesAlive = 0;
let gameStarted = false;
const MAX_RAGDOLL_PARTS = 200;
let totalParts = 0;

const colors = ['#e74c3c','#3498db','#f1c40f','#2ecc71','#9b59b6','#e67e22','#1abc9c','#ff69b4'];
const skinColors = ['#ffdbac','#f1c27d','#e0ac69','#c68642','#8d5524'];

function randomColor() { return colors[Math.floor(Math.random() * colors.length)]; }
function randomSkin() { return skinColors[Math.floor(Math.random() * skinColors.length)]; }
function randomBetween(min, max) { return Math.random() * (max - min) + min; }

// ============ START GAME ============
function startGame() {
  document.getElementById('blocker').style.display = 'none';
  document.getElementById('scene').setAttribute('visible', 'true');
  gameStarted = true;
  startWave();
}

// ============ WAVE SYSTEM ============
function startWave() {
  let waveText = document.getElementById('waveText');
  waveText.setAttribute('value', 'WAVE ' + wave);
  waveText.setAttribute('animation', 'property: scale; from: 0.1 0.1 0.1; to: 1 1 1; dur: 500');

  setTimeout(() => { waveText.setAttribute('value', ''); }, 2000);

  let enemyCount = 3 + wave * 2;
  for (let i = 0; i < enemyCount; i++) {
    setTimeout(() => {
      spawnEnemy({
        x: randomBetween(-8, 8),
        y: 0,
        z: randomBetween(-30, -15)
      }, true);
    }, i * 800);
  }
}

function checkWave() {
  if (enemiesAlive <= 0 && gameStarted) {
    wave++;
    setTimeout(startWave, 2000);
  }
}

// ============ BLOOD SYSTEM ============
function createBloodSplatter(position, intensity) {
  let scene = docu
